http:
  routers:
    # --- Router for AUTH service (NO auth middleware) ---
    router-auth:
      rule: "Host(`localhost`) && PathPrefix(`/auth`)"
      entryPoints:
        - web
      service: service-auth
      priority: 10 # High priority

    # --- Router for USER service (people) ---
    router-people:
      rule: "Host(`localhost`) && PathPrefix(`/api/people`)"
      entryPoints:
        - web
      middlewares:
        - jwt-auth # Apply JWT auth
        - strip-api  # Strip /api
      service: service-people
      priority: 10 # High priority

    # --- Router for DEVICE service ---
    router-devices:
      rule: "Host(`localhost`) && (PathPrefix(`/api/devices`) || PathPrefix(`/api/device-users`) || PathPrefix(`/api/users`))"
      entryPoints:
        - web
      middlewares:
        - jwt-auth # Apply JWT auth
        - strip-api  # Strip /api
      service: service-devices
      priority: 10 # High priority

  middlewares:
    # --- Middleware to strip the /api prefix ---
    strip-api:
      stripPrefix: 
        prefixes:
          - "/api"

    # --- Middleware definition for JWT Authentication ---
    # This matches the labels we removed from docker-compose.yml
    jwt-auth:
      plugin:
        jwt-validation-middleware:
          secret: "supersecret123456supersecret123456"
          signingMethod: "HS256"
          authHeader: true
          claims: "role"
          requiredClaim:
            role: ["ROLE_USER", "ROLE_ADMIN"]
          payloadHeaders:
            X-User: "sub"
            X-Role: "role"

  services:
    # --- Service for AUTH ---
    # Points to http://auth-service:8081
    service-auth:
      loadBalancer:
        servers:
          - url: "http://auth-service:8081" 

    # --- Service for USERS (PEOPLE) ---
    # Points to http://user_api_service:8080
    service-people:
      loadBalancer:
        servers:
          - url: "http://user_api_service:8080" 

    # --- Service for DEVICES ---
    # Points to http://device_api_service:8080
    service-devices:
      loadBalancer:
        servers:
          - url: "http://device_api_service:8080"